# Task ID: 15
# Title: Implementar gestión de sesiones (completar/interrumpir ayuno)
# Status: done
# Dependencies: 8
# Priority: high
# Description: Desarrollar lógica para finalizar ayunos correctamente, guardar métricas y actualizar historial del usuario
# Details:
Extender TimerService con completeFast() e interruptFast() methods. Al completar: marcar session.completed = true, calcular duration final, save to Isar, trigger metrics recalculation, mostrar congratulations UI, sync to Supabase. Al interrumpir: marcar interrupted = true, save partial session, preguntar razón (opcional), no penalizar métricas severamente. Implementar SessionManager para orchestrate estos flows.

# Test Strategy:
Verificar sessions se guardan correctamente, probar sync funciona, validar métricas se actualizan apropiadamente

# Subtasks:
## 1. Extender TimerService con métodos completeFast() e interruptFast() [done]
### Dependencies: None
### Description: Implementar los métodos principales en TimerService para gestionar la finalización e interrupción de ayunos con toda la lógica de negocio requerida
### Details:
Agregar completeFast() method que marque session.completed = true, calcule duration final y trigger todos los flows de completion. Implementar interruptFast() method que marque session.interrupted = true, guarde partial session y maneje el flow de interrupción. Ambos métodos deben actualizar el estado interno del TimerService y notificar a los listeners apropiados.

## 2. Implementar persistencia y sincronización de sesiones [done]
### Dependencies: 15.1
### Description: Desarrollar la lógica para guardar sesiones completadas/interrumpidas en Isar y sincronizar con Supabase
### Details:
Al completar ayuno: guardar session en Isar con completed=true y duration final, trigger recalculation de métricas, sync a Supabase. Al interrumpir: guardar partial session con interrupted=true, opcional reason field, no penalizar métricas severamente. Implementar error handling para sync failures y retry logic apropiado.

## 3. Crear SessionManager para orchestrar flows y UI de completion [done]
### Dependencies: 15.1, 15.2
### Description: Desarrollar SessionManager central que coordine los flows de completion/interrupción y mostrar UI apropiada
### Details:
Implementar SessionManager que orchestrate calls a TimerService y maneje UI flows. Para completion: mostrar congratulations UI con estadísticas del ayuno completado. Para interrupción: mostrar dialog preguntando razón opcional con opciones predefinidas. Coordinar con navigation para transitions apropiadas y state management.

